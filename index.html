<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Cache buster: updated to fix sizeControls error -->
    <title>GameInvitation –ö–∞—Ä—É—Å–µ–ª—å</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/interactjs/dist/interact.min.js"></script>

    <!-- CodeMirror –¥–ª—è –ø–æ–¥—Å–≤–µ—Ç–∫–∏ JSON -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/codemirror.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/theme/dracula.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/javascript/javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/addon/edit/matchbrackets.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/addon/edit/closebrackets.min.js"></script>

    <link rel="stylesheet" href="styles.css">

    <script src="js/config.js"></script>
    <script src="js/state.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/free-positioning.js"></script>
    <script src="js/panels.js"></script>
    <script src="js/layers.js"></script>
    <script src="js/images.js"></script>
    <script src="js/image-controls.js"></script>
    <script src="js/watermark.js"></script>
    <script src="js/drag-drop.js"></script>
    <script src="js/slides-generator.js"></script>
    <script src="js/main.js"></script>
</head>
<body>
    <!-- –ü–∞–Ω–µ–ª—å –ø—Ä–æ–µ–∫—Ç–æ–≤ –∏ —Å–ª–∞–π–¥–æ–≤ —Å–ª–µ–≤–∞ -->
    <div id="projects-panel" class="projects-panel">
        <h3>–ü—Ä–æ–µ–∫—Ç—ã</h3>
        <div id="projects-list"></div>
        
        <h3 style="margin-top: 20px; border-top: 1px solid rgba(255,255,255,0.2); padding-top: 15px;">–°–ª–∞–π–¥—ã</h3>
        <div id="slides-nav" style="display: flex; flex-direction: column; gap: 8px; max-height: 400px; overflow-y: auto;"></div>
        
        <div id="import-json-area" class="import-json-area" style="margin-top: 15px;">
            <input type="file" id="import-json-input" accept=".json" style="display: none;">
            <button id="import-json-btn" class="import-btn">–ò–º–ø–æ—Ä—Ç JSON</button>
            <div class="drag-drop-hint">–∏–ª–∏ –ø–µ—Ä–µ—Ç–∞—â–∏—Ç–µ JSON —Ñ–∞–π–ª —Å—é–¥–∞</div>
            <textarea id="json-text-input" placeholder="–ò–ª–∏ –≤—Å—Ç–∞–≤—å—Ç–µ JSON —Ç–µ–∫—Å—Ç –∑–¥–µ—Å—å..." style="width: 100%; height: 100px; margin-top: 10px; padding: 8px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 6px; color: white; font-family: monospace; font-size: 12px; resize: vertical;"></textarea>
        </div>
    </div>
    
    <!-- –ü–∞–Ω–µ–ª—å –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤ —Å–ø—Ä–∞–≤–∞ –≤–≤–µ—Ä—Ö—É -->
    <div id="add-elements-panel" style="position: fixed; right: 20px; top: 120px; display: flex; flex-direction: column; gap: 15px; z-index: 900;">
        <button class="add-element-btn" data-type="emoji" title="–≠–º–æ–¥–∂–∏">üòä</button>
        <button class="add-element-btn" data-type="title" title="–ó–∞–≥–æ–ª–æ–≤–æ–∫">H1</button>
        <button class="add-element-btn" data-type="text" title="–¢–µ–∫—Å—Ç">T</button>
        <button class="add-element-btn" data-type="image" title="–ö–∞—Ä—Ç–∏–Ω–∫–∞">üñºÔ∏è</button>
    </div>
    
    <!-- –ü–∞–Ω–µ–ª—å —Å–ª–æ—ë–≤ —Å–ø—Ä–∞–≤–∞ -->
    <div id="layers-panel" style="position: fixed; right: 20px; top: 350px; width: 250px; max-height: 500px; background: rgba(20, 20, 20, 0.95); border-radius: 12px; padding: 15px; z-index: 900; border: 1px solid rgba(255,255,255,0.2); backdrop-filter: blur(10px); overflow-y: auto;">
        <h3 style="color: white; margin: 0 0 15px 0; font-size: 16px; border-bottom: 1px solid rgba(255,255,255,0.2); padding-bottom: 10px;">–°–ª–æ–∏</h3>
        <div id="layers-list" style="display: flex; flex-direction: column; gap: 5px;"></div>
    </div>
    
    <div class="format-toggle">
        <button class="format-btn active" data-format="1-1">1:1</button>
        <button class="format-btn" data-format="4-5">4:5</button>
        <button class="format-btn" data-format="9-16">9:16</button>
    </div>
    <div id="export-controls" class="export-controls">
        <button id="export-btn" class="export-btn">–≠–∫—Å–ø–æ—Ä—Ç</button>
        <button id="save-json-btn" class="export-btn" style="background: #10b981;">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å JSON</button>
        <button id="edit-json-btn" class="export-btn" style="background: #0891b2;">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å JSON</button>
        <button id="watermark-btn" class="export-btn" style="background: #8b5cf6;">–í–æ–¥—è–Ω–æ–π –∑–Ω–∞–∫</button>

        <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid rgba(255,255,255,0.2);">
            <label style="display: block; color: rgba(255,255,255,0.8); font-size: 13px; margin-bottom: 8px;">
                –†–∞–∑–º–µ—Ä —Ç–µ–∫—Å—Ç–∞: <span id="font-scale-value" style="color: #3b82f6; font-weight: bold;">100%</span>
            </label>
            <input type="range" id="font-scale-slider" min="70" max="300" value="100" style="width: 100%; cursor: pointer;">
            <small style="color: rgba(255,255,255,0.5); display: block; margin-top: 5px;">–†–µ–≥—É–ª–∏—Ä—É–µ—Ç –≤—Å–µ —Ä–∞–∑–º–µ—Ä—ã —Ç–µ–∫—Å—Ç–∞ –≤ –ø—Ä–æ–µ–∫—Ç–µ</small>
        </div>

        <label class="export-checkbox">
            <input type="checkbox" id="export-1-1" checked> 1:1
        </label>
        <label class="export-checkbox">
            <input type="checkbox" id="export-4-5" checked> 4:5
        </label>
        <label class="export-checkbox">
            <input type="checkbox" id="export-9-16" checked> 9:16
        </label>
        <label class="export-checkbox" style="margin-left: 15px; padding-left: 15px; border-left: 1px solid rgba(255,255,255,0.3);">
            <input type="checkbox" id="preview-both"> –ü—Ä–µ–≤—å—é –æ–±–∞ —Ñ–æ—Ä–º–∞—Ç–∞
        </label>
    </div>
    
    <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —Å–ª–∞–π–¥–æ–≤ -->
    <div id="slides-container"></div>

    <!-- –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞ JSON -->
    <div id="json-editor-panel" style="position: fixed; top: 0; right: -50%; width: 50%; height: 100vh; background: #282a36; z-index: 10000; box-shadow: -5px 0 30px rgba(0,0,0,0.5); transition: right 0.3s ease; display: flex; flex-direction: column;">
        <!-- –†–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–∞ -->
        <div id="json-resize-handle" style="position: absolute; left: 0; top: 0; width: 8px; height: 100%; cursor: ew-resize; background: linear-gradient(90deg, rgba(139, 233, 253, 0.3) 0%, transparent 100%); z-index: 10001; transition: background 0.2s;">
            <div style="position: absolute; left: 3px; top: 50%; transform: translateY(-50%); width: 2px; height: 60px; background: #8be9fd; border-radius: 2px; opacity: 0.5;"></div>
        </div>

        <div style="display: flex; justify-content: space-between; align-items: center; padding: 20px; background: #21222c; border-bottom: 2px solid #44475a;">
            <div style="display: flex; align-items: center; gap: 12px;">
                <h2 style="color: #f8f8f2; margin: 0; font-size: 20px;">üìù JSON –†–µ–¥–∞–∫—Ç–æ—Ä</h2>
                <span style="background: #50fa7b; color: #282a36; padding: 4px 10px; border-radius: 12px; font-size: 11px; font-weight: 700; letter-spacing: 0.5px;">‚ö° LIVE</span>
            </div>
            <button id="close-json-editor" style="background: #ff5555; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 16px; transition: background 0.2s;">‚úï –ó–∞–∫—Ä—ã—Ç—å</button>
        </div>

        <div id="json-editor-container" style="flex: 1; overflow: hidden;"></div>

        <div style="padding: 15px; background: #21222c; border-top: 2px solid #44475a;">
            <div id="json-error-message" style="color: #ff5555; margin-bottom: 10px; min-height: 20px; font-size: 13px; font-weight: 500;"></div>
            <div style="display: flex; gap: 10px;">
                <button id="apply-json-btn" class="export-btn" style="flex: 1; background: #50fa7b; color: #282a36; font-weight: 600; padding: 12px;">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏ –∑–∞–∫—Ä—ã—Ç—å</button>
                <button id="format-json-btn" class="export-btn" style="background: #8be9fd; color: #282a36; font-weight: 600;">‚ö° –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
            </div>
        </div>
    </div>

    <!-- Overlay –¥–ª—è –∑–∞—Ç–µ–º–Ω–µ–Ω–∏—è —Ñ–æ–Ω–∞ -->
    <div id="json-editor-overlay" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 9999; opacity: 0; transition: opacity 0.3s ease;"></div>
</body>
</html>